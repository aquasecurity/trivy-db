package vulnerability

import (
	"testing"

	"github.com/aquasecurity/trivy-db/pkg/types"
	"github.com/aquasecurity/trivy/pkg/vulnsrc/vulnerability"
	"github.com/stretchr/testify/assert"
)

func Test_GetDetail(t *testing.T) {
	oldgetVulnDetailFunc := getVulnDetailFunc
	defer func() {
		getVulnDetailFunc = oldgetVulnDetailFunc
	}()

	getVulnDetailFunc = func(cveID string) (m map[string]types.VulnerabilityDetail, err error) {
		return map[string]types.VulnerabilityDetail{
			vulnerability.Nvd: {
				ID:          "CVE-2019-0160",
				CvssScore:   7.0,
				CvssScoreV3: 9.0,
				Severity:    types.SeverityCritical,
				SeverityV3:  0,
				References:  nil,
				Title:       "",
				Description: "",
			},
			vulnerability.RedHat: {
				ID:          "CVE-2019-0160",
				CvssScore:   7.0,
				CvssScoreV3: 9.0,
				Severity:    types.SeverityLow,
				SeverityV3:  0,
				VendorSeverity: types.VendorSeverity{
					vulnerability.RedHat: types.SeverityLow,
				},
				References:  nil,
				Title:       "",
				Description: "",
			},
		}, nil
	}

	actualSeverity, _, _, _ := GetDetail("CVE-2019-0160")
	assert.Equal(t, types.VendorSeverity{RedHat: types.SeverityLow}, actualSeverity)
}
